---
title: 迁移到 Changesets
sidebarTitle: Changesets 迁移
---

# 迁移到 Changesets

我们已成功从 release-it 迁移到 changesets 进行 monorepo 版本管理。本文档记录了迁移过程和使用指南。

## 迁移背景

### 原有问题
- release-it 在 monorepo 环境下版本号不同步
- 配置复杂，依赖多个插件
- 难以支持固定版本号发布模式

### Changesets 优势
- 专为 monorepo 设计
- 支持固定版本模式（fixed）
- 更灵活的版本控制策略
- 更好的 changelog 生成

## 新的工作流程

### 1. 日常开发

添加新的变更：
```bash
pnpm changeset
```

按照提示操作：
- 选择受影响的包
- 选择变更类型（patch/minor/major）
- 添加变更描述

### 2. 版本发布

版本发布现在通过 GitHub Actions 工作流完成：

1. 在 GitHub 仓库页面触发 "NPM 发布" 工作流
2. 输入目标版本号（例如：0.0.8, 0.0.8-beta.0）
3. 工作流会自动：
   - 应用所有待处理的 changesets
   - 更新所有包的版本号（固定版本模式）
   - 生成 CHANGELOG.md
   - 创建 git tag
   - 发布到 NPM
   - 创建 GitHub Release

## 版本管理策略

### 固定版本包

以下包使用固定版本，版本号始终保持一致：
- `bestmcp`
- `@bestmcp/server`
- `@bestmcp/client`

当其中任何一个包有变更时，所有包的版本号都会同步升级。

### 独立版本包

未来的 `@bestmcp/cli` 将使用独立版本管理。

## 配置详解

### Changesets 配置

主要配置文件：`.changeset/config.json`

```json
{
  "changelog": ["@changesets/changelog-github", {
    "repo": "shenjingnan/bestmcp"
  }],
  "commit": false,
  "fixed": [
    ["bestmcp", "@bestmcp/server", "@bestmcp/client"]
  ],
  "linked": [],
  "access": "public",
  "baseBranch": "main",
  "updateInternalDependencies": "patch"
}
```

### 关键配置说明

- **fixed**: 定义固定版本包组，这些包的版本号将保持同步
- **changelog**: 使用 GitHub 风格的 changelog 生成器
- **updateInternalDependencies**: 内部依赖更新策略

## 常用命令

```bash
# 添加变更记录
pnpm changeset

# 查看待处理的变更
pnpm changeset status

# 应用版本更新（本地测试用）
pnpm changeset version

# 发布到 NPM（通过 GitHub Actions）
# 在 GitHub 仓库页面手动触发工作流
```

## 注意事项

1. **不要手动修改包版本号**：所有版本变更都通过 changesets 管理
2. **每次提交都应该有对应的 changeset**：除非是纯粹的文档或配置更新
3. **版本发布只能通过 GitHub Actions 进行**：确保 Trusted Publisher 正常工作
4. **测试版本更新时记得重置**：使用 `git checkout` 重置包版本号

## 故障排除

### 版本号不一致
如果发现包版本号不一致，检查：
- `.changeset/config.json` 中的 `fixed` 配置
- 是否手动修改了包版本号

### Changesets 不工作
检查：
- 是否正确安装了 `@changesets/cli`
- `.changeset/config.json` 配置是否正确
- 是否在正确的目录执行命令

### 发布失败
检查：
- GitHub Actions 工作流配置
- NPM token 配置
- Trusted Publisher 设置