{
  "git": {
    "commitMessage": "chore: release v${version}",
    "tagName": "v${version}",
    "pushArgs": ["--follow-tags"],
    "requireCleanWorkingDir": false,
    "requireUpstream": false,
    "commit": true,
    "tag": true,
    "push": true
  },
  "github": {
    "release": true,
    "releaseName": "🚀 v${version}",
    "releaseNotes": "npx conventional-changelog-cli -p conventionalcommits"
  },
  "npm": {
    "publish": true,
    "publishArgs": ["--access", "public", "--force"],
    "skipChecks": true,
    "registry": "https://registry.npmjs.org/",
    "force": true,
    "ignoreVersion": true,
    "allowSameVersion": true
  },
  "plugins": {
    "@release-it-plugins/workspaces": {
      "workspaces": ["packages/server", "packages/client"],
      "rootWorkspace": true,
      "updateRootVersion": true,
      "includeWorkspaceRoot": true,
      "version": true,
      "forcePublish": true,
      "syncVersions": true,
      "dependencies": false,
      "devDependencies": false,
      "publish": {
        "packages": ["packages/server", "packages/client"],
        "root": false
      }
    },
    "@release-it/conventional-changelog": {
      "preset": "conventionalcommits",
      "infile": "CHANGELOG.md",
      "releaseCommitMessageFormat": "chore: release v${version}",
      "ignoreRecommendedBump": false,
      "strictSemVer": true
    }
  },
  "hooks": {
    "before:init": [
      "pnpm audit --audit-level moderate",
      "pnpm test",
      "pnpm type:check",
      "pnpm check:fix",
      "echo '🔍 检查版本同步状态...' && node -e \"const root=require('./package.json').version, client=require('./packages/client/package.json').version, server=require('./packages/server/package.json').version; console.log('版本状态:', {root, client, server}); if(root!==client||root!==server) { console.error('❌ 版本不同步!'); process.exit(1); } else { console.log('✅ 版本同步正常'); }\""
    ],
    "before:release": [
      "pnpm clean",
      "pnpm build:packages",
      "echo '📦 发布前版本检查...' && node -e \"const root=require('./package.json').version, client=require('./packages/client/package.json').version, server=require('./packages/server/package.json').version; console.log('即将发布版本:', {root, client, server});\""
    ],
    "after:bump": [
      "pnpm build:packages",
      "echo '📝 版本号更新完成，验证同步...' && node -e \"const root=require('./package.json').version, client=require('./packages/client/package.json').version, server=require('./packages/server/package.json').version; console.log('更新后版本:', {root, client, server});\""
    ],
    "after:release": ["echo \"🎉 版本 v${version} 发布完成！\""]
  }
}
